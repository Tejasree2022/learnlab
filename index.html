<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearnLab AI - Learn Anything with AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4285f4;
            --primary-dark: #3367d6;
            --secondary: #34a853;
            --accent: #ea4335;
            --warning: #fbbc05;
            --light: #f8f9fa;
            --dark: #202124;
            --gray: #5f6368;
            --border: #dadce0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --radius: 16px;
            --gradient: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
        }

        body {
            font-family: 'Google Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f0fe 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ===== HEADER ===== */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(66, 133, 244, 0.3);
        }

        .logo-icon i {
            font-size: 2.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 3rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .logo-text .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #e8f0fe;
            color: var(--primary);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .tagline {
            font-size: 1.3rem;
            color: var(--gray);
            max-width: 800px;
            margin: 0 auto 25px;
        }

        .features {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .feature {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--gray);
        }

        .feature i {
            color: var(--primary);
            font-size: 1.2rem;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Left Sidebar */
        .sidebar {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .sidebar h2 {
            color: var(--dark);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
        }

        .search-box {
            position: relative;
            margin-bottom: 25px;
        }

        #searchInput {
            width: 100%;
            padding: 18px 55px 18px 25px;
            font-size: 1.1rem;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            outline: none;
            transition: all 0.3s;
            background: var(--light);
        }

        #searchInput:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.2);
            background: white;
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .btn {
            width: 100%;
            padding: 18px;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(66, 133, 244, 0.3);
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .btn i {
            font-size: 1.2rem;
        }

        .quick-examples {
            margin-top: 30px;
        }

        .quick-examples h3 {
            color: var(--gray);
            font-size: 1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .example-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .example-tag {
            background: var(--light);
            color: var(--gray);
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border);
        }

        .example-tag:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Right Content */
        .content-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* Loading */
        .loading {
            background: white;
            border-radius: var(--radius);
            padding: 60px 40px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: none;
        }

        .ai-thinking {
            width: 80px;
            height: 80px;
            margin: 0 auto 25px;
            position: relative;
        }

        .ai-thinking .gemini-logo {
            width: 50px;
            height: 50px;
            background: var(--gradient);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-thinking .gemini-logo i {
            color: white;
            font-size: 1.5rem;
        }

        .ai-thinking .orbit {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px dashed var(--primary);
            border-radius: 50%;
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--gray);
            font-size: 1.1rem;
            margin-top: 20px;
        }

        .loading-dots {
            display: inline-flex;
            gap: 4px;
            margin-top: 10px;
        }

        .dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: pulse 1.5s infinite ease-in-out;
        }

        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes pulse {
            0%, 100% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        /* Error */
        .error {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: none;
        }

        .error-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            color: var(--accent);
        }

        .error-header i {
            font-size: 2rem;
        }

        .error-content {
            color: var(--gray);
            line-height: 1.7;
        }

        .error-solution {
            background: #fef7e0;
            border-left: 4px solid var(--warning);
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 var(--radius) var(--radius) 0;
        }

        /* Topic Display */
        .topic-container {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            overflow: hidden;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .topic-header {
            background: var(--gradient);
            color: white;
            padding: 35px 40px;
            position: relative;
        }

        .topic-header h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .topic-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .topic-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 18px;
            border-radius: 25px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
        }

        .ai-badge-small {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .topic-content {
            padding: 40px;
        }

        .explanation-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.4rem;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }

        .explanation-box {
            background: var(--light);
            padding: 30px;
            border-radius: var(--radius);
            line-height: 1.8;
            color: var(--dark);
            border-left: 4px solid var(--primary);
        }

        .explanation-box p {
            margin-bottom: 20px;
        }

        .explanation-box p:last-child {
            margin-bottom: 0;
        }

        /* Tasks */
        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .task-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            border: 1px solid var(--border);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
        }

        .task-card.beginner::before { background: var(--secondary); }
        .task-card.intermediate::before { background: var(--warning); }
        .task-card.advanced::before { background: var(--accent); }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-number {
            font-size: 0.85rem;
            color: var(--gray);
            font-weight: 600;
        }

        .task-difficulty {
            font-size: 0.75rem;
            font-weight: 700;
            padding: 6px 15px;
            border-radius: 20px;
            text-transform: uppercase;
        }

        .beginner .task-difficulty { background: #e6f4ea; color: #137333; }
        .intermediate .task-difficulty { background: #fef7e0; color: #b06000; }
        .advanced .task-difficulty { background: #fce8e6; color: #c5221f; }

        .task-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .task-description {
            color: var(--gray);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .task-hint {
            background: #f0f6ff;
            border-left: 3px solid var(--primary);
            padding: 15px;
            border-radius: 0 var(--radius) var(--radius) 0;
            margin-top: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .task-hint i {
            color: var(--primary);
            margin-top: 2px;
        }

        .hint-content {
            font-size: 0.95rem;
            color: var(--dark);
        }

        .hint-content strong {
            color: var(--primary);
        }

        /* Related Topics */
        .related-topics {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid var(--border);
        }

        .related-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
        }

        .related-tag {
            background: var(--light);
            color: var(--primary);
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .related-tag:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px;
            color: var(--gray);
            font-size: 0.95rem;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .footer-link {
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.2s;
        }

        .footer-link:hover {
            color: var(--primary-dark);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .logo {
                flex-direction: column;
                gap: 15px;
            }

            .logo-text h1 {
                font-size: 2.2rem;
                text-align: center;
            }

            .tagline {
                font-size: 1.1rem;
            }

            .features {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .main-content {
                gap: 20px;
            }

            .sidebar, .topic-content {
                padding: 25px;
            }

            .topic-header {
                padding: 25px;
            }

            .topic-header h2 {
                font-size: 1.8rem;
            }

            .tasks-grid {
                grid-template-columns: 1fr;
            }

            .ai-badge-small {
                position: static;
                margin-top: 15px;
                width: fit-content;
            }
        }

        /* ===== UTILITIES ===== */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --light: #2d2d2d;
                --dark: #ffffff;
                --gray: #b0b0b0;
                --border: #444444;
            }

            body {
                background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            }

            .sidebar, .topic-container, footer, .loading, .error {
                background: #2d2d2d;
                border-color: #444444;
            }

            .explanation-box {
                background: #363636;
            }

            .task-card {
                background: #363636;
                border-color: #444444;
            }

            .related-tag {
                background: #363636;
                border-color: #444444;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="logo-text">
                    <h1>LearnLab AI</h1>
                    <div class="ai-badge">
                        <i class="fas fa-robot"></i>
                        Powered by Google Gemini AI
                    </div>
                </div>
            </div>
            <p class="tagline">
                Learn anything instantly! Ask any topic, get clear AI-generated explanations with practice tasks.
                No database needed - infinite learning possibilities.
            </p>
            <div class="features">
                <div class="feature">
                    <i class="fas fa-bolt"></i>
                    <span>Instant AI Explanations</span>
                </div>
                <div class="feature">
                    <i class="fas fa-tasks"></i>
                    <span>Practice Tasks & Hints</span>
                </div>
                <div class="feature">
                    <i class="fas fa-infinity"></i>
                    <span>Unlimited Topics</span>
                </div>
                <div class="feature">
                    <i class="fas fa-gem"></i>
                    <span>Free Tier: 60 req/min</span>
                </div>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- SIDEBAR -->
            <div class="sidebar">
                <h2><i class="fas fa-search"></i> What do you want to learn?</h2>
                
                <div class="search-box">
                    <input type="text" id="searchInput" 
                           placeholder="Type any topic... (e.g., machine learning, cooking pasta, quantum physics)">
                    <div class="search-icon">
                        <i class="fas fa-search"></i>
                    </div>
                </div>

                <button class="btn" onclick="searchTopic()" id="searchBtn">
                    <i class="fas fa-robot"></i>
                    Generate Learning Guide
                </button>

                <div class="quick-examples">
                    <h3><i class="fas fa-lightbulb"></i> Quick Examples</h3>
                    <div class="example-tags">
                        <div class="example-tag" onclick="searchExample('Python programming basics')">Python Basics</div>
                        <div class="example-tag" onclick="searchExample('machine learning introduction')">Machine Learning</div>
                        <div class="example-tag" onclick="searchExample('how to invest in stocks')">Stock Investing</div>
                        <div class="example-tag" onclick="searchExample('French revolution summary')">French Revolution</div>
                        <div class="example-tag" onclick="searchExample('cooking pasta properly')">Cooking Pasta</div>
                        <div class="example-tag" onclick="searchExample('quantum physics for beginners')">Quantum Physics</div>
                    </div>
                </div>
            </div>

            <!-- CONTENT AREA -->
            <div class="content-area">
                <!-- LOADING -->
                <div class="loading" id="loading">
                    <div class="ai-thinking">
                        <div class="orbit"></div>
                        <div class="gemini-logo">
                            <i class="fas fa-gem"></i>
                        </div>
                    </div>
                    <h3>AI is creating your learning guide...</h3>
                    <p class="loading-text">
                        Google Gemini AI is analyzing the topic and generating explanations with practice tasks.
                    </p>
                    <div class="loading-dots">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                </div>

                <!-- ERROR -->
                <div class="error" id="errorContainer">
                    <div class="error-header">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Something went wrong</h3>
                    </div>
                    <div class="error-content" id="errorMessage">
                        <!-- Error message appears here -->
                    </div>
                    <div class="error-solution" id="errorSolution">
                        <!-- Solution appears here -->
                    </div>
                </div>

                <!-- TOPIC DISPLAY -->
                <div class="topic-container" id="topicContainer">
                    <!-- Dynamic content goes here -->
                </div>

                <!-- WELCOME MESSAGE (Default) -->
                <div class="topic-container" id="welcomeMessage">
                    <div class="topic-header">
                        <h2>Welcome to LearnLab AI! ü§ñ</h2>
                        <div class="ai-badge-small">
                            <i class="fas fa-gem"></i>
                            Google Gemini AI
                        </div>
                    </div>
                    <div class="topic-content">
                        <div class="explanation-section">
                            <h3 class="section-title"><i class="fas fa-info-circle"></i> How It Works</h3>
                            <div class="explanation-box">
                                <p><strong>LearnLab AI</strong> uses Google's Gemini AI to instantly create learning materials for ANY topic you want to learn.</p>
                                
                                <p><strong>‚ú® Just type any topic:</strong></p>
                                <ul style="margin-left: 20px; margin-bottom: 20px;">
                                    <li>Academic: "quantum physics", "calculus", "photosynthesis"</li>
                                    <li>Technical: "Python programming", "machine learning", "web development"</li>
                                    <li>Practical: "cooking pasta", "changing a tire", "personal finance"</li>
                                    <li>Hobbies: "guitar basics", "photography", "chess strategies"</li>
                                </ul>
                                
                                <p><strong>üéØ What you get:</strong></p>
                                <ul style="margin-left: 20px;">
                                    <li>Clear, detailed explanations</li>
                                    <li>4 practice tasks (beginner to advanced)</li>
                                    <li>Helpful hints for each task</li>
                                    <li>Related topics to explore next</li>
                                </ul>
                            </div>
                        </div>

                        <div class="tasks-section">
                            <h3 class="section-title"><i class="fas fa-tasks"></i> Try These Examples</h3>
                            <div class="tasks-grid">
                                <div class="task-card beginner">
                                    <div class="task-header">
                                        <span class="task-number">Example 1</span>
                                        <span class="task-difficulty">Beginner</span>
                                    </div>
                                    <h4 class="task-title">Search "Python functions"</h4>
                                    <p class="task-description">Learn about functions in Python with examples and practice exercises.</p>
                                </div>

                                <div class="task-card intermediate">
                                    <div class="task-header">
                                        <span class="task-number">Example 2</span>
                                        <span class="task-difficulty">Intermediate</span>
                                    </div>
                                    <h4 class="task-title">Search "machine learning basics"</h4>
                                    <p class="task-description">Understand ML fundamentals with practical implementation tasks.</p>
                                </div>

                                <div class="task-card advanced">
                                    <div class="task-header">
                                        <span class="task-number">Example 3</span>
                                        <span class="task-difficulty">Advanced</span>
                                    </div>
                                    <h4 class="task-title">Search "quantum computing"</h4>
                                    <p class="task-description">Explore quantum concepts with challenging problem-solving tasks.</p>
                                </div>
                            </div>
                        </div>

                        <div class="related-topics">
                            <h3 class="section-title"><i class="fas fa-rocket"></i> Get Started</h3>
                            <p style="color: var(--gray); margin-bottom: 20px;">
                                Type any topic in the search box and click "Generate Learning Guide"
                            </p>
                            <div class="related-tags">
                                <div class="related-tag" onclick="searchExample('artificial intelligence basics')">
                                    <i class="fas fa-microchip"></i>
                                    AI Basics
                                </div>
                                <div class="related-tag" onclick="searchExample('how to bake a cake')">
                                    <i class="fas fa-utensils"></i>
                                    Baking Cake
                                </div>
                                <div class="related-tag" onclick="searchExample('stock market investing')">
                                    <i class="fas fa-chart-line"></i>
                                    Stock Market
                                </div>
                                <div class="related-tag" onclick="searchExample('French revolution')">
                                    <i class="fas fa-landmark"></i>
                                    French Revolution
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <footer>
            <p>
                <strong>LearnLab AI v2.0</strong> ‚Ä¢ Powered by Google Gemini AI ‚Ä¢ Free Tier: 60 requests per minute
            </p>
            <div class="footer-links">
                <a href="http://localhost:3000/api/health" target="_blank" class="footer-link">
                    <i class="fas fa-heartbeat"></i> API Health
                </a>
                <a href="https://makersuite.google.com/app/apikey" target="_blank" class="footer-link">
                    <i class="fas fa-key"></i> Get API Key
                </a>
                <div class="footer-link" onclick="showRateLimit()">
                    <i class="fas fa-tachometer-alt"></i> Rate Limit
                </div>
                <div class="footer-link" onclick="searchExample('how this AI works')">
                    <i class="fas fa-question-circle"></i> How It Works
                </div>
            </div>
        </footer>
    </div>

    <script>
        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const loading = document.getElementById('loading');
        const errorContainer = document.getElementById('errorContainer');
        const errorMessage = document.getElementById('errorMessage');
        const errorSolution = document.getElementById('errorSolution');
        const topicContainer = document.getElementById('topicContainer');
        const welcomeMessage = document.getElementById('welcomeMessage');

        // Example topics for quick search
        const examples = [
            "Python programming basics",
            "machine learning introduction", 
            "how to invest in stocks",
            "French revolution summary",
            "cooking pasta properly",
            "quantum physics for beginners",
            "artificial intelligence ethics",
            "web development fundamentals",
            "photography composition techniques",
            "meditation for beginners",
            "climate change causes and effects",
            "how the internet works",
            "blockchain technology explained",
            "neural networks basics",
            "personal finance management"
        ];

        // Set random placeholder
        function setRandomPlaceholder() {
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            searchInput.placeholder = `Type any topic... Like: "${randomExample}"`;
        }

        // Search for topic using AI
        async function searchTopic() {
            const topic = searchInput.value.trim();
            
            if (!topic) {
                showError('Please enter a topic to learn', 'Try: "machine learning" or "cooking pasta"');
                searchInput.focus();
                return;
            }

            // Show loading, hide other sections
            loading.style.display = 'block';
            errorContainer.style.display = 'none';
            topicContainer.style.display = 'none';
            welcomeMessage.style.display = 'none';
            
            // Disable button and show AI thinking
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> AI is thinking...';

            try {
                console.log(`üîç Searching: "${topic}"`);
                
                // Call our AI backend API
                const response = await fetch(`http://localhost:3000/api/topic?q=${encodeURIComponent(topic)}`);
                const data = await response.json();
                
                if (!response.ok) {
                    // Handle API errors
                    if (response.status === 429) {
                        throw new Error('Rate limit exceeded. Free tier allows 60 requests per minute.');
                    } else if (response.status === 401) {
                        throw new Error('Invalid API key. Please check your Google Gemini API key.');
                    } else {
                        throw new Error(data.error || `API Error: ${response.status}`);
                    }
                }
                
                // Display the AI-generated topic
                displayTopic(data);
                
                // Clear any previous errors
                errorContainer.style.display = 'none';
                
                // Update search history (optional)
                addToSearchHistory(topic);
                
            } catch (error) {
                console.error('Search error:', error);
                
                // Show user-friendly error message
                if (error.message.includes('Rate limit')) {
                    showError(
                        '‚è≥ Rate Limit Exceeded',
                        'Google Gemini free tier allows 60 requests per minute. Please wait a minute and try again.',
                        'This is a free service limitation. For higher limits, consider upgrading your API plan.'
                    );
                } else if (error.message.includes('API key') || error.message.includes('AI service not configured')) {
                    showError(
                        'üîë API Key Required',
                        'Google Gemini API key is not configured.',
                        '1. Get free API key: https://makersuite.google.com/app/apikey<br>2. Add to .env file: GEMINI_API_KEY=your_key_here<br>3. Restart the server'
                    );
                } else if (error.message.includes('Failed to fetch')) {
                    showError(
                        'üåê Connection Error',
                        'Cannot connect to the LearnLab server.',
                        'Make sure the server is running: run "npm start" in terminal'
                    );
                } else {
                    showError(
                        'ü§ñ AI Service Error',
                        error.message,
                        'The AI service might be temporarily unavailable. Try a different topic or wait a moment.'
                    );
                }
                
            } finally {
                // Reset UI
                loading.style.display = 'none';
                searchBtn.disabled = false;
                searchBtn.innerHTML = '<i class="fas fa-robot"></i> Generate Learning Guide';
            }
        }

        // Display AI-generated topic
        function displayTopic(data) {
            // Determine icon based on stream
            const streamIcons = {
                'cse': 'fas fa-laptop-code',
                'ece': 'fas fa-microchip',
                'science': 'fas fa-flask',
                'math': 'fas fa-calculator',
                'commerce': 'fas fa-chart-line',
                'arts': 'fas fa-palette',
                'general': 'fas fa-book'
            };
            
            const streamIcon = streamIcons[data.stream] || 'fas fa-book';
            const category = data.category || 'General Knowledge';
            
            // Create topic HTML
            topicContainer.innerHTML = `
                <div class="topic-header">
                    <h2>${data.title}</h2>
                    <div class="ai-badge-small">
                        <i class="fas fa-gem"></i>
                        Generated by AI ‚Ä¢ ${data.source || 'gemini_ai'}
                    </div>
                    <div class="topic-meta">
                        ${data.stream ? `
                            <div class="topic-tag">
                                <i class="${streamIcon}"></i>
                                ${data.stream.toUpperCase()}
                            </div>
                        ` : ''}
                        ${data.category ? `
                            <div class="topic-tag">
                                <i class="fas fa-tag"></i>
                                ${data.category}
                            </div>
                        ` : ''}
                        ${data.ai_model ? `
                            <div class="topic-tag">
                                <i class="fas fa-cogs"></i>
                                ${data.ai_model}
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                <div class="topic-content">
                    <div class="explanation-section">
                        <h3 class="section-title"><i class="fas fa-info-circle"></i> Explanation</h3>
                        <div class="explanation-box">
                            ${formatExplanation(data.explanation)}
                        </div>
                    </div>
                    
                    <div class="tasks-section">
                        <h3 class="section-title"><i class="fas fa-tasks"></i> Practice Tasks</h3>
                        <div class="tasks-grid">
                            ${data.tasks.map((task, index) => `
                                <div class="task-card ${task.difficulty}">
                                    <div class="task-header">
                                        <span class="task-number">Task ${index + 1}</span>
                                        <span class="task-difficulty">${task.difficulty}</span>
                                    </div>
                                    <h4 class="task-title">${task.title}</h4>
                                    <p class="task-description">${task.description}</p>
                                    ${task.hint ? `
                                        <div class="task-hint">
                                            <i class="fas fa-lightbulb"></i>
                                            <div class="hint-content">
                                                <strong>Hint:</strong> ${task.hint}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    ${data.related_topics && data.related_topics.length > 0 ? `
                        <div class="related-topics">
                            <h3 class="section-title"><i class="fas fa-link"></i> Related Topics</h3>
                            <div class="related-tags">
                                ${data.related_topics.map(topic => `
                                    <div class="related-tag" onclick="searchRelated('${topic}')">
                                        <i class="fas fa-arrow-right"></i>
                                        ${topic}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${data.rate_limit ? `
                        <div class="related-topics" style="margin-top: 30px; padding-top: 20px; border-top: 1px dashed var(--border);">
                            <h3 class="section-title"><i class="fas fa-tachometer-alt"></i> API Status</h3>
                            <p style="color: var(--gray);">
                                Remaining requests this minute: <strong>${data.rate_limit.remaining}</strong> of 60
                                <br>
                                <small>Free tier limit resets every minute</small>
                            </p>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Show topic container
            topicContainer.style.display = 'block';
            welcomeMessage.style.display = 'none';
            
            // Smooth scroll to results
            setTimeout(() => {
                topicContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // Format explanation text (convert newlines to paragraphs)
        function formatExplanation(text) {
            if (!text) return '<p>No explanation available.</p>';
            
            // Split by double newlines for paragraphs
            const paragraphs = text.split('\n\n');
            
            // If no double newlines, split by single newlines
            if (paragraphs.length <= 1) {
                return text.split('\n').map(line => 
                    line.trim() ? `<p>${line}</p>` : ''
                ).join('');
            }
            
            // Format paragraphs
            return paragraphs.map(para => 
                para.trim() ? `<p>${para.replace(/\n/g, '<br>')}</p>` : ''
            ).join('');
        }

        // Show error message
        function showError(title, message, solution = '') {
            errorMessage.innerHTML = `
                <h4 style="margin-bottom: 10px; color: var(--accent);">${title}</h4>
                <p>${message}</p>
            `;
            
            errorSolution.innerHTML = solution ? `
                <strong><i class="fas fa-wrench"></i> Solution:</strong>
                <p style="margin-top: 8px;">${solution}</p>
            ` : '';
            
            errorContainer.style.display = 'block';
            topicContainer.style.display = 'none';
            welcomeMessage.style.display = 'none';
            
            // Scroll to error
            errorContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Search for related topic
        function searchRelated(topic) {
            searchInput.value = topic;
            searchTopic();
        }

        // Search example topic
        function searchExample(topic) {
            searchInput.value = topic;
            searchTopic();
        }

        // Add to search history (local storage)
        function addToSearchHistory(topic) {
            try {
                const history = JSON.parse(localStorage.getItem('learnlab_history') || '[]');
                history.unshift({
                    topic: topic,
                    timestamp: new Date().toISOString()
                });
                // Keep only last 10 searches
                localStorage.setItem('learnlab_history', JSON.stringify(history.slice(0, 10)));
            } catch (e) {
                console.log('Could not save to history:', e);
            }
        }

        // Show rate limit info
        function showRateLimit() {
            alert('Google Gemini Free Tier Limits:\n\n‚Ä¢ 60 requests per minute\n‚Ä¢ Suitable for personal/educational use\n‚Ä¢ Get API key: https://makersuite.google.com/app/apikey\n\nFor higher limits, upgrade your API plan.');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set random placeholder
            setRandomPlaceholder();
            // Change placeholder every 15 seconds
            setInterval(setRandomPlaceholder, 15000);
            
            // Enter key to search
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchTopic();
                }
            });
            
            // Focus search input
            searchInput.focus();
            
            // Show welcome message initially
            welcomeMessage.style.display = 'block';
            topicContainer.style.display = 'none';
        });
    </script>
</body>
</html>
